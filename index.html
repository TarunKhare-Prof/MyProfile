<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tarun Khare â€“ Portfolio</title>
  <link rel="stylesheet" href="style.css?v=1.0.3" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
</head>
<body>
  <header>
    <svg class="wave" viewBox="0 0 1440 90" preserveAspectRatio="none">
      <path d="M0,50 C400,140 1040,-40 1440,50 L1440,90 L0,90 Z"></path>
    </svg>
    <div class="header-content">
      <img src="images/profile.jpg" alt="Tarun Khare" class="profile-pic" />
      <div class="text-content">
        <h1>Tarun Khare</h1>
        <h2>Sr. Software Engineer</h2>
      </div>
    </div>
  </header>

  <nav id="tabs"></nav>
  <main id="tabWrapper"></main>

  <div id="lightbox" class="hidden">
    <span class="close">&times;</span>
    <div class="lightbox-content"></div>
  </div>

  <script>
    const fetchJSON = async (p) => (await fetch(p)).json();

    function showTab(id) {
      document.querySelectorAll('.tab-content')
              .forEach(el => el.classList.toggle('active', el.id === id));
    }

    function openLightbox(html) {
      const lb = document.getElementById('lightbox');
      const content = lb.querySelector('.lightbox-content');
      content.innerHTML = html;
      void content.offsetHeight;
      lb.style.display = 'flex';
      lb.classList.remove('hidden');
    }

    function closeLightbox() {
      const lb = document.getElementById('lightbox');
      const content = lb.querySelector('.lightbox-content');
      const video = content.querySelector('video');
      if (video) {
        video.pause();
        video.currentTime = 0;
      }
      content.innerHTML = '';
      lb.style.display = 'none';
      lb.classList.add('hidden');
    }

    (async () => {
      const data = await fetchJSON('data/portfolio.json');
      const nav = document.getElementById('tabs');
      const wrap = document.getElementById('tabWrapper');

      for (let i = 0; i < data.tabs.length; i++) {
        const tab = data.tabs[i];

        const btn = document.createElement('button');
        btn.innerHTML = `<i class="fa-regular fa-circle"></i> ${tab.label}`;
        btn.onclick = () => showTab(tab.id);
        nav.appendChild(btn);

        const sec = document.createElement('section');
        sec.className = 'tab-content';
        sec.id = tab.id;
        sec.innerHTML = `<h2>${tab.title}</h2>`;

        if (tab.id === 'personal') {
          const personalData = await fetchJSON('data/personal_projects.json');
          const grid = document.createElement('div');
          grid.className = 'projects-flex-list';

          grid.innerHTML = personalData.map((p, index) => {
            const mediaList = Array.isArray(p.media) ? p.media : [p.media];
            const mediaNav = mediaList.length > 1 ? `
              <button class="media-nav prev" onclick="showPrev(${index})">&#8592;</button>
              <button class="media-nav next" onclick="showNext(${index})">&#8594;</button>` : '';
            const mediaContent = mediaList.map((src, i) =>
              p.type === 'video'
                ? `<video preload="metadata" muted class="media-item ${i === 0 ? 'active' : ''}"><source src="${src}" type="video/mp4"></video>`
                : `<img src="${src}" class="media-item ${i === 0 ? 'active' : ''}" alt="${p.title}">`
            ).join('');

            return `
              <div class="project-row" id="project-${index}">
                <div class="media-column">
                  <div class="media-wrapper">
                    ${mediaContent}
                    ${mediaNav}
                  </div>
                </div>
                <div class="desc-column">
                  <h3>${p.title}</h3>
                  <p><strong>Date:</strong> ${p.date}</p>
                  <p><strong>About:</strong> ${p.description.about}</p>
                  <p><strong>Coding:</strong> ${p.description.coding}</p>
                  <p><strong>Hardware:</strong> ${p.description.hardware}</p>
                </div>
              </div>
            `;
          }).join('');

          sec.appendChild(grid);

        } else if (tab.skillsGrouped) {
          Object.entries(tab.skillsGrouped).forEach(([category, skills]) => {
            const grid = document.createElement('div');
            grid.className = 'skills-grid';
            grid.innerHTML = `<h3>${category}</h3>` +
              skills.map(sk => `<div class="skill">${sk.name}</div>`).join('');
            sec.appendChild(grid);
          });
        } else if (tab.skills) {
          sec.innerHTML += `<div class="skills-bars">
            ${tab.skills.map(sk => `
              <div class="skill-bar">
                <span>${sk.name}</span>
                <div class="bar"><div class="fill" style="width:${sk.level}%"></div></div>
              </div>`).join('')}
          </div>`;
        } else if (tab.content) {
          sec.innerHTML += tab.content.map(t => `<p>${t}</p>`).join('');
        }

        wrap.appendChild(sec);
        if (i === 0) sec.classList.add('active');
      }

      document.getElementById('lightbox').addEventListener('click', (e) => {
        if (e.target.id === 'lightbox' || e.target.classList.contains('close')) {
          closeLightbox();
        }
      });

      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          closeLightbox();
        }
      });
    })();

    function showPrev(index) {
      const items = document.querySelectorAll(`#project-${index} .media-item`);
      const current = [...items].findIndex(i => i.classList.contains('active'));
      if (current > 0) {
        items[current].classList.remove('active');
        items[current - 1].classList.add('active');
      }
    }

    function showNext(index) {
      const items = document.querySelectorAll(`#project-${index} .media-item`);
      const current = [...items].findIndex(i => i.classList.contains('active'));
      if (current < items.length - 1) {
        items[current].classList.remove('active');
        items[current + 1].classList.add('active');
      }
    }
  </script>

  <footer>
    <div class="footer-inner">
      <p>Made with ðŸ’» by Tarun Khare &copy; <span id="year"></span></p>
      <p>Last Updated: <span id="lastModified"></span></p>
      <div class="social">
        <a href="https://www.linkedin.com/in/tarun-khare-98ab5085/" aria-label="LinkedIn">
          <i class="fa-brands fa-linkedin"></i>
        </a>
      </div>
    </div>
  </footer>

  <script>
    document.getElementById('year').textContent = new Date().getFullYear();
    document.getElementById('lastModified').textContent = new Date(document.lastModified).toLocaleString();
  </script>
</body>
</html>